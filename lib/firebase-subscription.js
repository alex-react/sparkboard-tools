// Generated by CoffeeScript 1.7.1

/*

  Turn a firebase manifest into a subscription object.
 */

(function() {
  module.exports = function(manifest) {
    manifest.subscribe = function(updateDataCallback) {
      manifest.query = manifest.query || function(ref, cb) {
        return cb(ref);
      };
      return manifest.query(manifest.ref, (function(_this) {
        return function(ref) {
          var cancelUpdateObject, updateObject;
          if (ref === null) {
            manifest.inactive = true;
            updateDataCallback(manifest["default"]);
            return;
          }
          manifest.queryRef = ref;
          updateObject = function(snapshot) {
            var parse, value;
            parse = manifest.parse || function(snapshot) {
              return snapshot.val();
            };
            value = parse(snapshot);
            return updateDataCallback(value);
          };
          cancelUpdateObject = function() {
            return updateDataCallback(manifest["default"]);
          };
          return ref.on("value", updateObject, cancelUpdateObject);
        };
      })(this));
    };
    manifest.unsubscribe = function() {
      var _ref;
      if (manifest.inactive !== true) {
        return (_ref = manifest.queryRef) != null ? _ref.off() : void 0;
      }
    };
    return manifest;
  };

}).call(this);
